# DEMO2022-2023-linux-only

![изображение](https://user-images.githubusercontent.com/28905300/175996163-e7dbdb7b-2d18-4150-906a-ac925f3a66c7.png)

## Таблица 1. Характеристики ВМ

|Name VM         |ОС                  |RAM             |CPU             |IP                    |Additionally                       |
|  ------------- | -------------      | -------------  |  ------------- |  -------------       |  -------------                    |  
|RTR-L           |Debian 11/CSR       |2 GB            |2/4             |4.4.4.100/24          |                                   |
|                |                    |                |                |192.168.100.254/24    |                                   |
|RTR-R           |Debian 11/CSR       |2 GB            |2/4             |5.5.5.100/24          |                                   |
|                |                    |                |                |172.16.100.254 /24    |                                   |
|SRV             |Debian 11/Win 2019  |2 GB /4 GB      |2/4             |192.168.100.200/24    |Доп диски 2 шт по 5 GB             |
|WEB-L           |Debian 11           |2 GB            |2               |192.168.100.100/24    |                                   |
|WEB-R           |Debian 11           |2 GB            |2               |172.16.100.100/24     |                                   |
|ISP             |Debian 11           |2 GB            |2               |4.4.4.1/24            |                                   |
|                |                    |                |                |5.5.5.1/24            |                                   |
|                |                    |                |                |3.3.3.1/24            |                                   |
|CLI             |Win 10              |4 GB            |4               |3.3.3.10/24           |                                   |

## Виртуальные машины и коммутация.
Необходимо выполнить создание и базовую конфигурацию виртуальных
машин.

1. На основе предоставленных ВМ или шаблонов ВМ создайте отсутствующие виртуальные машины в соответствии со схемой.  
   -	Характеристики ВМ установите в соответствии с Таблицей 1;
   -	Коммутацию (если таковая не выполнена) выполните в соответствии со схемой сети.	 
2.  Имена хостов в созданных ВМ должны быть установлены в соответствии со схемой.
3.  Адресация должна быть выполнена в соответствии с Таблицей 1;
4.  Обеспечьте ВМ дополнительными дисками, если таковое необходимо в соответствии с Таблицей 1;

###### #(Если изначально доступна работа из под пользователя с обычными привилегиями, то повышение привилегий, то есть работа из под root, выполняется через команду *sudo -i*).
###### #На текущем этапе, пока что выполняется настройка имён хостов и IP-адресации.
![изображение](https://user-images.githubusercontent.com/28905300/175999607-fa8103f4-050f-4a61-a7a6-735731709549.png)

## МОНТИРОВАНИЕ ОБРАЗОВ И УСТАНОВКА ПАКЕТОВ
###### #На демо-экзамене предоставляются ISO-образы с дополнительным ПО. Установка пакетов через них. Выход в реальный интернет не предоставляется.
###### #К примеру, на виртуальной машине RTR-L нужно установить необходимые по заданию пакеты. Для этого необходимо вмонтировать в VM один из ISO-образов и добавить его в source.list (необязательно все, только самый первый).
![изображение](https://user-images.githubusercontent.com/28905300/176243706-b3aeef9f-3c18-4751-9d64-8be7f0673a72.png)

![изображение](https://user-images.githubusercontent.com/28905300/176243826-8e15bde7-00d3-4bf6-8a80-8cb64cd0921c.png)

![изображение](https://user-images.githubusercontent.com/28905300/176243935-32885bf7-d4b8-4545-a043-58b7c8b9dec0.png)

![изображение](https://user-images.githubusercontent.com/28905300/176243995-4ef6b621-4f40-44a0-b17d-2b7b0985e423.png)
###### #Одновременно с добавлением образа в source.list, производится обновление списка доступных пакетов от каждого смонтированного образа.
###### #Если требуется установить ПО, связанные с которым пакеты находятся на нескольких образах, то в proxmox надо так же выбрать уже другой образ, по образцу выше. После этого в Debian, для обновления пакетов от другого образа, нужно выполнить следующие команды:
![изображение](https://user-images.githubusercontent.com/28905300/176244112-ecd85e48-fa15-4652-a48f-6f4275bfafe3.png)
###### #А далее снова *apt-cdrom add*.
###### #Добавляем автомонтирование образа с ПО при перезагрузке виртуальной машины.
![изображение](https://user-images.githubusercontent.com/28905300/176244201-f6917ac3-990a-4bd1-9b66-c66b2a4bea50.png)
###### #(в nano сохранение изменений на *CTRL+S*, выход — *CTRL+X*)
![изображение](https://user-images.githubusercontent.com/28905300/176244404-16091ebc-c042-411c-abf9-1deb5503aef4.png)
##### Очень полезные сочетания клавиш в nano: 
##### Alt + 6 — копировать одну или несколько строк.
##### Ctrl + U — вставить строку или строки.
##### Ctrl + K — вырезать (удалить) строку.
##### Alt + T — удалить ВСЁ ниже курсора.
##### Ctrl + S — сохранить изменения.
##### Ctrl + X — выход.
##### Длинные пробелы ставятся при нажатии на TAB.

###### #Далее нужно настроить статическую IP-адресацию на каждой машине. Адресация представлена в конце комплекта оценочной документации. Для сопоставления MAC-адресов с IP-адресами на каждой машине, нужно проделать следующее:
![изображение](https://user-images.githubusercontent.com/28905300/176244746-4648f67f-364e-4c7d-88aa-86664629d5a0.png)
###### #На proxmox, при выборе виртуальной машины и просмотре списка его оборудования, нужно обратить внимание на MAC-адрес и имя моста (bridge). У другой машины, присоединённой к текущей (пример ISP), имя моста будет идентичным.
![изображение](https://user-images.githubusercontent.com/28905300/176244904-2d890844-4d5f-4db3-9483-b473a16b4e4b.png)
###### #По одинаковому названию моста можно увидеть связность конкретных машин. По их MAC-адресам — связь с IP-адресами.
#### ПЕРВЫЙ ВАРИАНТ НАСТРОЙКИ
###### #Настройка IP-адресов каждой машины (кроме CLI). Каждый интерфейс настраивается через *nmcli* одной длинной командой:
#### ISP
![изображение](https://user-images.githubusercontent.com/28905300/176245056-6706c377-7406-47b8-b58b-da6be538ec09.png)
###### #Названия интерфейсов можно посмотреть и через *nmcli connection*. Если наименования не содержат *Wired connection* и они имеют красный цвет, то нужно ввести команду *systemctl restart NetworkManager* и заново ввести *nmcli connection*.
![изображение](https://user-images.githubusercontent.com/28905300/176243233-2fb935d9-5d3e-41a1-8d6c-7d8ba3d3a785.png)
###### #Элементы команд полностью не нужно вписывать (кроме имён и цифр). Достаточно вбить начало команды (пример: ipv4.ad), как в терминале Cisco, и через нажатие на TAB произойдёт автодописывание (ipv4.addresses).
###### #Пример соответствует самой первой введёной строке:
###### nmc(TAB) co(TAB) mod(TAB) Wi(TAB) 1 ipv4.a(TAB) 5.5.5.1/24 ipv4.me(TAB) m(TAB) au(TAB) y(TAB) con-n(TAB) ISP-RTRR.
#### RTR-R
![изображение](https://user-images.githubusercontent.com/28905300/176381588-691c1fa6-a173-443a-98d9-a395dd1afcc0.png)
#### RTR-L
![изображение](https://user-images.githubusercontent.com/28905300/176381793-9cb85679-d860-41ff-a184-8e01121ba158.png)
#### WEB-L
![изображение](https://user-images.githubusercontent.com/28905300/176381968-10409a3c-c436-4f75-a10f-e2ff426d656f.png)
#### SRV
![изображение](https://user-images.githubusercontent.com/28905300/176382133-444ea1e8-10a0-49cc-8937-d87cad6696fe.png)
#### WEB-R
![изображение](https://user-images.githubusercontent.com/28905300/176382245-a676d222-22e9-4c10-bc44-538660cad981.png)
#### CLI
###### #На виртуальной машине CLI, по заданию, операционная система Windows 10. Порядок изменения имени хоста и IP-адреса там другой:
![изображение](https://user-images.githubusercontent.com/28905300/176009988-c0fa9d7a-74e4-4a4b-878b-08aa0375e485.png)

![изображение](https://user-images.githubusercontent.com/28905300/176010008-f28839a2-39ce-4bb8-85be-a6c83f67fb57.png)

![изображение](https://user-images.githubusercontent.com/28905300/176010035-149e5876-2d9e-4884-b2e8-330a842ab685.png)

![изображение](https://user-images.githubusercontent.com/28905300/176010052-77bd725e-8e6c-4ef2-82a6-3a9d37e7209e.png)

![изображение](https://user-images.githubusercontent.com/28905300/176010074-29212295-b515-4b54-8521-74e93d16bd90.png)
###### #Жмём на OK, заходим в PowerShell и пингуем шлюз по умолчанию (ISP). Далее меняем имя хоста:
![изображение](https://user-images.githubusercontent.com/28905300/176010140-0332983c-106e-4a4b-8efc-50fc888bbc06.png)

![изображение](https://user-images.githubusercontent.com/28905300/176010153-90806f3e-b203-4b85-a7d7-fd4654fef1c5.png)

![изображение](https://user-images.githubusercontent.com/28905300/176010174-468b241f-463d-481c-8f46-aba1c53c740c.png)
###### #Запрос о перезагрузке подтверждаем.
#### ВТОРОЙ ВАРИАНТ НАСТРОЙКИ
###### #(короткие команды в nmcli):
#### ISP
![изображение](https://user-images.githubusercontent.com/28905300/176387802-3f73e22f-5f88-42a1-97f9-b5ebf0882296.png)

![изображение](https://user-images.githubusercontent.com/28905300/176387985-6422a16a-0319-42a9-9867-2b37763a4174.png)
#### RTR-R
![изображение](https://user-images.githubusercontent.com/28905300/176388472-d0dee906-9829-42d2-a663-25383220260c.png)
#### RTR-L
![изображение](https://user-images.githubusercontent.com/28905300/176388804-e6b337ce-539b-4ad8-a37e-5316a3c0282c.png)
#### WEB-L
![изображение](https://user-images.githubusercontent.com/28905300/176388969-f5855453-7f40-4a23-8849-baa95fec6c45.png)
#### SRV
![изображение](https://user-images.githubusercontent.com/28905300/176389146-f7792fe1-b075-49d0-8f01-13cf50cbe2ec.png)
#### WEB-R
![изображение](https://user-images.githubusercontent.com/28905300/176389663-832481a1-0da3-4e61-9199-3e532a35e74c.png)
###### #После настройки IP-адресации, проверяем доступность соседних устройств с помощью команды *ping*.
###### #Для отправки файлов с помощью *scp* (или для соединения по ssh), нужно отредактировать *sshd_config* на начальной (откуда), конечной (куда отправляем файл) и промежуточной виртуальной машине (через какую машину проходит файл). Допустим, нужно отправить файл test с RTR-L на RTR-R. После установки пакетов, включая ssh, на RTR-L, RTR-R и ISP между ними редактируется строка с разрешением на аутентификацию из под root.
![изображение](https://user-images.githubusercontent.com/28905300/176393008-670c5070-d976-44a0-a50f-b9e01bd49851.png)

![изображение](https://user-images.githubusercontent.com/28905300/176393137-5b0393ea-ab68-4953-bcbc-e95ad9b0e788.png)

![изображение](https://user-images.githubusercontent.com/28905300/176393373-af99a376-4a1c-436e-9378-319c03b99efa.png)
## Сетевая связность.
В рамках данного модуля требуется обеспечить сетевую связность между
регионами работы приложения, а также обеспечить выход ВМ в имитируемую
сеть “Интернет”
##
1. Сети, подключенные к ISP, считаются внешними:
   - Запрещено прямое попадание трафика из внутренних сетей во внешние и наоборот;
###### #Сперва, нужно разрешить пересылку пакетов через устройства, осуществляющих маршрутизацию (RTR-L, ISP и RTR-R).
![изображение](https://user-images.githubusercontent.com/28905300/176395129-b093c8f5-259b-411d-a916-62d44fa60676.png)

![изображение](https://user-images.githubusercontent.com/28905300/176395238-52737eea-00f5-4c06-a0ad-153250691839.png)
###### #Для выполнения условия о запрете прямого прохождения трафика, необходимо установить *firewalld* на RTR-L и RTR-R. Интерфейсы на них, смотрящие во внешние сети, определить в зону *external*. В зоне *external* разрешён не весь, а только определённый вручную тип трафика, а также выполняется трансляция трафика, идущего из внутренних сетей во внешние.
![изображение](https://user-images.githubusercontent.com/28905300/176395560-4328479c-3f44-4137-b66d-06a5e3009a58.png)

![изображение](https://user-images.githubusercontent.com/28905300/176395661-7726b0c5-527a-4177-b535-e6e324d87254.png)
###### #Выявляем интерфейсы, которые смотрят во «внешние» сети.
![изображение](https://user-images.githubusercontent.com/28905300/176395973-bbb2d5b5-3583-4dbc-bb5b-45fe29ec5c40.png)

![изображение](https://user-images.githubusercontent.com/28905300/176396149-4833c7c0-1401-45c5-b93a-148d72d9924b.png)

![изображение](https://user-images.githubusercontent.com/28905300/176396304-d10a253f-6315-4f01-9bf1-3e8871950d70.png)

![изображение](https://user-images.githubusercontent.com/28905300/176396415-b5a75ffe-fe25-4ac3-b8eb-06f6d20f6865.png)

![изображение](https://user-images.githubusercontent.com/28905300/176396503-78855e07-a419-4a63-b61a-8d60e8f21223.png)
##
2. Платформы контроля трафика, установленные на границах регионов, должны выполнять трансляцию трафика, идущего из соответствующих внутренних сетей во внешние сети стенда и в сеть Интернет.
   - Трансляция исходящих адресов производится в адрес платформы,расположенный во внешней сети.
###### #Условия выполнены примерами выше.
##
3. Между платформами должен быть установлен защищенный туннель, позволяющий осуществлять связь между регионами с применением внутренних адресов.
   - Трафик, проходящий по данному туннелю, должен быть защищен:
     - Платформа ISP не должна иметь возможности просматривать содержимое пакетов, идущих из одной внутренней сети в другую.
   - Туннель должен позволять защищенное взаимодействие между платформами управления трафиком по их внутренним адресам
     - Взаимодействие по внешним адресам должно происходит без применения туннеля и шифрования
   - Трафик, идущий по туннелю между регионами по внутренним адресам, не должен транслироваться.
###### #На RTR-L и RTR-R устанавливаем *libreswan* для работы IPsec (создание защищённого туннеля). Для его установки потребуется использовать два образа с ПО, монтируя и извлекая их поочерёдно, когда потребует этого установщик в debian.
![изображение](https://user-images.githubusercontent.com/28905300/176397254-3a369195-5a31-4aa2-ba58-a4cabd6b858f.png)
###### #Сначала выполняется создание GRE-туннеля между RTR-L и RTR-R. После — настройка файрволла на ISP. Поверх туннеля — настройка IPsec.
![изображение](https://user-images.githubusercontent.com/28905300/176400175-43c8a332-d604-4e28-9320-3f349ff8b384.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400304-d06403bb-0df8-4aab-9b85-01ca7c703c95.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400393-60f4e7c0-1781-4390-af4a-50a2911b4b7c.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400466-113d2e78-c49c-40c3-9337-d97423d17c8c.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400571-6f37bbee-d908-4c0c-8154-5a8bacc678ae.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400662-42e11941-5509-434b-841a-e0f0911d8443.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400746-017b9513-a8d2-4dbe-a90a-3afb576a7277.png)

![изображение](https://user-images.githubusercontent.com/28905300/176400912-de0b416d-c2df-48af-b589-9ae0f019e2a9.png)
### IPsec
###### #Создаём файлы конфигурации и ключа.
![изображение](https://user-images.githubusercontent.com/28905300/176401785-ba074292-a2ba-4b24-88f1-1a441216019f.png)

![изображение](https://user-images.githubusercontent.com/28905300/176401885-f359c791-a588-45d5-ad71-3341ecc4ac44.png)
###### #Для большего удобства, лучше скопировать *mytunnel.conf* и *mytunnel.secrets* с RTR-L на RTR-R через scp, в аналогичную директорию.
![изображение](https://user-images.githubusercontent.com/28905300/176402205-5a06ff7d-309f-4ba7-a28d-bd6961e60171.png)

![изображение](https://user-images.githubusercontent.com/28905300/176402302-d1b1cf29-1c58-453a-b410-af655ce8d769.png)

![изображение](https://user-images.githubusercontent.com/28905300/176402401-80c074c8-5f3f-4745-8407-b319e814e672.png)

![изображение](https://user-images.githubusercontent.com/28905300/176402659-94f4885f-fde8-4ee8-ba49-00ad067d8985.png)
###### #Дополнительная проверка работы IPsec. Запуск *tcpdump* на ISP, при оправке ICMP-запросов с RTR-R на RTR-L. На скрине ниже видно, что ICMP-запросы и ответы именуются иначе.
![изображение](https://user-images.githubusercontent.com/28905300/176403111-ad521d76-25be-4402-8a20-57209e6aaa40.png)
### EIGRP или OSPF
###### #Для организации подключения виртуальных машин, имеющих адреса во внутренних сетях, к новосозданному туннелю и для связи стороны Left со стороной Right, нужно настроить один из протоколов маршрутизации (EIGRP или OSPF) с помощью *frr*.
![изображение](https://user-images.githubusercontent.com/28905300/176403581-02e01bd4-e9b0-4920-beee-1e66ceffc689.png)

![изображение](https://user-images.githubusercontent.com/28905300/176432599-407e57e2-00a1-4ca5-88a9-29eeff5d4ab0.png)

![изображение](https://user-images.githubusercontent.com/28905300/176432687-f825bfa4-317b-49ff-a52e-88eed4ca4af2.png)

![изображение](https://user-images.githubusercontent.com/28905300/176432763-faa93cc0-a217-4baf-b8dd-4b93d37173b0.png)

![изображение](https://user-images.githubusercontent.com/28905300/176432843-23c6d560-3a9e-430f-a7de-b42c47222d6c.png)

![изображение](https://user-images.githubusercontent.com/28905300/176432938-1831c32c-6a16-463a-b5f0-384870508753.png)

![изображение](https://user-images.githubusercontent.com/28905300/176433005-51afdea8-7adf-4128-a0a3-324f65c4e44d.png)

![изображение](https://user-images.githubusercontent.com/28905300/176433102-c473ca1a-a610-4e15-b7db-92bdf943bc51.png)

![изображение](https://user-images.githubusercontent.com/28905300/176433175-880bccb7-ab1b-49ef-a794-04283ef17e71.png)

![изображение](https://user-images.githubusercontent.com/28905300/176433360-ed75c01c-a0ba-47d6-b655-23b8e2f4f203.png)
##
4. Платформа управления трафиком RTR-L выполняет контроль входящего трафика согласно следующим правилам:
    - Разрешаются подключения к портам DNS, HTTP и HTTPS для всех клиентов;
      - Порты необходимо для работы настраиваемых служб
    - Разрешается работа выбранного протокола организации защищенной связи; 
      - Разрешение портов должно быть выполнено по принципу “необходимо и достаточно”
    - Разрешается работа протоколов ICMP;
    - Разрешается работа протокола SSH;
    - Прочие подключения запрещены;
    - Для обращений в платформам со стороны хостов, находящихся внутри регионов, ограничений быть не должно;

![изображение](https://user-images.githubusercontent.com/28905300/176436130-b9c61fa3-c9d6-48ee-8e37-484109109baa.png)

![изображение](https://user-images.githubusercontent.com/28905300/176436227-45cf590a-b10f-46f3-9648-526dc087e2a3.png)

![изображение](https://user-images.githubusercontent.com/28905300/176436304-e3beba9c-2dda-424b-afd0-89560d1fe052.png)
##
5. Платформа управления трафиком RTR-R выполняет контроль входящего трафика согласно следующим правилам:
   - Разрешаются подключения к портам HTTP и HTTPS для всех клиентов;
     - Порты необходимо для работы настраиваемых служб
   - Разрешается работа выбранного протокола организации защищенной связи;
     - Разрешение портов должно быть выполнено по принципу необходимо и достаточно”
   - Разрешается работа протоколов ICMP;
   - Разрешается работа протокола SSH;
   - Прочие подключения запрещены;
   - Для обращений в платформам со стороны хостов, находящихся внутри регионов, ограничений быть не должно;

![изображение](https://user-images.githubusercontent.com/28905300/176436970-5a645ebe-a8b9-4184-8fb5-02621ef398af.png)

![изображение](https://user-images.githubusercontent.com/28905300/176438714-2a42711e-25a3-4228-ae53-12c9022c79ac.png)
##
6. Обеспечьте настройку служб SSH региона Left и Right:
   - Подключения со стороны внешних сетей по протоколу к платформе управления трафиком RTR-L на порт 2222 должны быть перенаправлены на ВМ Web-L;
   - Подключения со стороны внешних сетей по протоколу к платформе управления трафиком RTR-R на порт 2244 должны быть перенаправлены на ВМ Web-R;
###### #На WEB-L и WEB-R также необходимо настроить ssh на приём соединений из под root.
![изображение](https://user-images.githubusercontent.com/28905300/176439216-bd86dff6-863a-4bb6-8db3-d855712c00d6.png)

![изображение](https://user-images.githubusercontent.com/28905300/176439327-1594fd0a-8996-4c01-a5c6-b0d1cc55c1d5.png)
###### #Проверка подключения по ssh. Если на CLI имя пользователя не «root», то к команде ssh дописывается *-l root* (английская л):
![изображение](https://user-images.githubusercontent.com/28905300/176439669-38286aa8-3746-43cc-bcfe-42cebe7e3309.png)
## Инфраструктурные службы
В рамках данного модуля необходимо настроить основные
инфраструктурные службы и настроить представленные ВМ на применение этих
служб для всех основных функций. 
##
1. Выполните настройку первого уровня DNS-системы стенда:
   - Используется ВМ ISP;
   - Обслуживается зона demo.wsr
     - Наполнение зоны должно быть реализовано в соответствии с Таблицей 2;
   - Сервер делегирует зону int.demo.wsr на SRV;
     - Поскольку SRV находится во внутренней сети западного региона, делегирование происходит на внешний адрес маршрутизатора данного региона. 
     - Маршрутизатор региона должен транслировать соответствующие порты DNS-службы в порты сервера SRV
   - Внешний клиент CLI должен использовать DNS-службу, развернутую на ISP, по умолчанию;
### *(Делегирование зоны — это не то же самое, что и создание slave-сервера! В нашем случае создаются два master-сервера!).*

## Таблица 2. DNS-записи зон (demo.wsr)

|Zone            |Type                |Key             |Meaning         |
|  ------------- | -------------      | -------------  |  ------------- |
| demo.wsr       | A                  | isp            | 3.3.3.1        |
|                | A                  | www            | 4.4.4.100      |
|                | A                  | www            | 5.5.5.100      |
|                | CNAME              | internet       | isp            |
|                | NS                 | int            | rtr-l.demo.wsr      |
|                | A                  | rtr-l       | 4.4.4.100      |

![изображение](https://user-images.githubusercontent.com/28905300/177474183-999afa2d-0566-4553-a806-37484f1e44c5.png)

![изображение](https://user-images.githubusercontent.com/28905300/177474251-820c87eb-56cb-4edf-aec6-4307f391a32d.png)

![изображение](https://user-images.githubusercontent.com/28905300/177474529-f8529ea4-3e2a-40ef-b1c0-0b5cef2bba81.png)

![изображение](https://user-images.githubusercontent.com/28905300/177474837-8a4e834c-9650-4bd4-aa98-e3c8158b3964.png)

![изображение](https://user-images.githubusercontent.com/28905300/177475181-5cd59dd8-0f1c-40ae-b833-46130941b95c.png)

![изображение](https://user-images.githubusercontent.com/28905300/177475284-f7edfbbf-eacb-44fd-8db1-c6929b58d1be.png)

![изображение](https://user-images.githubusercontent.com/28905300/177475362-b4719da0-1b05-41fb-86b4-394e6cd6b765.png)

![изображение](https://user-images.githubusercontent.com/28905300/177475449-cb95b5c3-3c53-4859-b2fc-6a8498b45f6c.png)

![изображение](https://user-images.githubusercontent.com/28905300/177475502-0fd04009-ab21-4f11-82f8-0f934f248a35.png)

![изображение](https://user-images.githubusercontent.com/28905300/177479687-a5ea134a-ac87-43bf-9b6f-404bf3cecf81.png)

![изображение](https://user-images.githubusercontent.com/28905300/177475702-df4b9baa-0d73-4a98-9879-acb7ce6afb5c.png)
##
2. Выполните настройку второго уровня DNS-системы стенда;
   - Используется ВМ SRV;
   - Обслуживается зона int.demo.wsr;
     - Наполнение зоны должно быть реализовано в соответствии с Таблицей 2;
   - Обслуживаются обратные зоны для внутренних адресов регионов
     - Имена для разрешения обратных записей следует брать из Таблицы 2;
   - Сервер принимает рекурсивные запросы, исходящие от адресов внутренних регионов;
     - Обслуживание клиентов(внешних и внутренних),  обращающихся к к зоне int.demo.wsr, должно производится без каких либо ограничений по адресу источника;
   - Внутренние хосты регионов (равно как и платформы управления трафиком) должны использовать данную DNS-службу для разрешения всех запросов имен;

## Таблица 3. DNS-записи зон (int.demo.wsr)

|Zone            |Type                |Key             |Meaning         |
|  ------------- | -------------      | -------------  |  ------------- |
| int.demo.wsr   | A                  | web-l           | 192.168.100.100        |
|                | A                  | web-r           | 172.16.100.100      |
|                | A                  | srv           | 192.168.100.200      |
|                | A                  | rtr-l            | 192.168.100.254      |
|                | A                  | rtr-r           | 172.16.100.254 |
|                | A                  | webapp2           | 192.168.100.100        |
|                | A                  | webapp2           | 172.16.100.100        |
|                | CNAME              | webapp        | webapp2            |
|                | CNAME              | ntp       | srv            |
|                | CNAME              | dns       | srv           |

###### #На SRV выполняются аналогичные шаги, вплоть до настройки apparmor. После apparmor — уже с дополнительными коррективами:

![изображение](https://user-images.githubusercontent.com/28905300/177477382-f1ad7812-72a4-4bf7-b468-9e5f462ae1b9.png)

![изображение](https://user-images.githubusercontent.com/28905300/177477425-f2b487ac-9747-4647-9fa1-a08e5b0e116b.png)

![изображение](https://user-images.githubusercontent.com/28905300/177477574-aee2be53-f131-4290-9895-274d5e7100f8.png)

![изображение](https://user-images.githubusercontent.com/28905300/177477667-e3c7281e-90e3-44ef-ba05-f21f552d161d.png)

![изображение](https://user-images.githubusercontent.com/28905300/177477888-de22bf68-f8a0-4957-8687-26680e43328a.png)

![изображение](https://user-images.githubusercontent.com/28905300/177477970-a84c1fce-d9c9-4114-a64f-595559f89d21.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478021-6ba233ac-3afe-419c-916e-ebb5c0d6cea3.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478093-36f758b4-b67d-4b47-a39f-4bb766aab21a.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478150-81d4a2ec-e3dd-45dc-a642-49ebb66de322.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478238-e529352b-0089-4f87-8335-1ed17398933c.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478404-9d4ddd94-c3eb-4d34-86e2-08cd7bd8efd6.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478457-91bca651-9427-4263-83cb-ee6eb0e5298d.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478518-301c9a1c-6a21-4d6c-9e36-675d7d4730aa.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478577-18afa501-1961-4612-8f0c-f595514fd053.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478725-ac6bc40c-e40f-4f00-b872-f7d7176021f7.png)

![изображение](https://user-images.githubusercontent.com/28905300/177478926-a6e1b292-6156-4eff-bc11-2c8bf434c98a.png)

![изображение](https://user-images.githubusercontent.com/28905300/177479040-69b3ac79-1941-41b5-a7f2-8d2f4e46be2e.png)
##
3. Выполните настройку первого уровня системы синхронизации времени:
   - Используется сервер ISP. 
   - Сервер считает собственный источник времени верным, stratum=4;
   - Сервер допускает подключение только через внешний адрес соответствующей платформы управления трафиком;
     - Подразумевается обращение SRV для синхронизации времени;
   - Клиент CLI должен использовать службу времени ISP;

![изображение](https://user-images.githubusercontent.com/28905300/177480336-603b7600-c1ea-4f95-9e34-1ca58a4a5e70.png)

![изображение](https://user-images.githubusercontent.com/28905300/177480761-5b68e66c-82a8-42a9-b1e6-8dba7ee5b39f.png)

![изображение](https://user-images.githubusercontent.com/28905300/177480823-de1bd665-ffce-417e-905d-f760b22b3f90.png)

![изображение](https://user-images.githubusercontent.com/28905300/177480886-4c1f8b11-5787-42fe-8b81-0ce97b000002.png)

![изображение](https://user-images.githubusercontent.com/28905300/177480950-11163af1-2f20-49e5-92f3-6738acaa7300.png)

###### #Далее нужно зайти на CLI и синхронизировать время с ISP. Для начала, нужно любыми способами зайти в Панель Управления и выбрать «Дата и Время».

![изображение](https://user-images.githubusercontent.com/28905300/177481182-55101bab-5535-40f2-9e0f-956198846260.png)

![изображение](https://user-images.githubusercontent.com/28905300/177481302-f01cfc9a-dfca-403c-b0c5-8e2d10f203c3.png)

![изображение](https://user-images.githubusercontent.com/28905300/177481443-9f47c8ae-1faa-4639-b331-c2b6959584e4.png)

###### #Дополнительно, нужно включить автоматическую синхронизацию времени и даты. Делается это так же через Control Panel (Панель управления) -> Administrative Tools -> Services -> Windows Time. С ручного управления переключаем на автоматическое, запускаем сервис и применяем изменения.

![изображение](https://user-images.githubusercontent.com/28905300/177484268-9105e94e-df37-466a-b2d2-fc4af265940f.png)

![изображение](https://user-images.githubusercontent.com/28905300/177485007-6431697d-6e9a-4148-8fcf-979e60b7e7fd.png)

###### #Примерно так должен выглядеть правильно настроенный сервис.

![изображение](https://user-images.githubusercontent.com/28905300/177485245-b59de726-571f-4448-b878-3ff563c3ab81.png)

![изображение](https://user-images.githubusercontent.com/28905300/177485322-d23d3074-784f-43d5-8bae-d8c14142aea3.png)
##
4. Выполните конфигурацию службы второго уровня времени на SRV
   - Сервер синхронизирует время с хостом ISP;
     - Синхронизация с другими источникам запрещена;
   - Сервер должен допускать обращения внутренних хостов регионов, в том числе и платформ управления трафиком, для синхронизации времени;
   - Все внутренние хосты(в том числе и платформы управления трафиком) должны синхронизировать свое время с SRV;

![изображение](https://user-images.githubusercontent.com/28905300/177494944-97a564cb-f51b-4032-9689-556ebb2e5be5.png)

![изображение](https://user-images.githubusercontent.com/28905300/177495126-78630b6e-e228-4cee-8361-f09b3203b234.png)

![изображение](https://user-images.githubusercontent.com/28905300/177495264-25ab7395-264c-4a5c-8ba1-b9fd71f9194f.png)

![изображение](https://user-images.githubusercontent.com/28905300/177495382-ece4d301-29c4-4600-89db-e13e896cc560.png)

![изображение](https://user-images.githubusercontent.com/28905300/177495506-eb765448-a22f-46e0-a141-4c5de3004e21.png)

![изображение](https://user-images.githubusercontent.com/28905300/177495630-12b30d22-2607-46cb-9c27-1d5dc9f4970d.png)

![изображение](https://user-images.githubusercontent.com/28905300/177495730-ab3ac8ba-c3da-4b3a-922f-811c345032ec.png)
##
5. Реализуйте файловый SMB-сервер на базе SRV
   - Сервер должен предоставлять доступ для обмена файлами серверам WEB-L и WEB-R;
   - Сервер, в зависимости от ОС, использует следующие каталоги для хранения файлов:
     - /mnt/storage для система на базе Linux;
     - Диск R:\ для систем на базе Windows;
   - Хранение файлов осуществляется на диске (смонтированном по указанным выше адресам), реализованном по технологии RAID типа “Зеркало”;
6. Сервера WEB-L и WEB-R должны использовать службу, настроенную на SRV, для обмена файлами между собой:
   - Служба файлового обмена должна позволять монтирование в виде стандартного каталога Linux
     - Разделяемый каталог должен быть смонтирован по адресу /opt/share;
   - Каталог должен позволять удалять и создавать файлы в нем для всех пользователей;

###### #На SRV сначала нужно реализовать программно RAID 1 (Зеркало) на двух накопителях по 2 ГБ. Сами накопители уже имеются на SRV. Наличие и наименования накопителей проверяются командами *fdisk -l* или *lsblk*.

![изображение](https://user-images.githubusercontent.com/28905300/177496459-65ad4e81-ffa3-4e89-a641-c1ce65d60cf9.png)

![изображение](https://user-images.githubusercontent.com/28905300/177497112-75f8136f-98f6-4317-af20-562cd2ed9bd6.png)

![изображение](https://user-images.githubusercontent.com/28905300/177497226-5b0805ca-b81a-4149-93ec-6ff85f08ca17.png)

![изображение](https://user-images.githubusercontent.com/28905300/177497324-f608be36-4c8c-4261-a227-1d4c3e33efa0.png)

![изображение](https://user-images.githubusercontent.com/28905300/177497406-c4d5fbf3-913e-4feb-99fe-9fcf8e2ce68f.png)

###### #Далее перезагружаем SRV командой *reboot*. После перезагрузки и входа из под *root*, перепроверяем наименование RAID-массива. Оно должно измениться.

![изображение](https://user-images.githubusercontent.com/28905300/177497806-3b3106db-e8cc-4c64-9bd8-5ff1c4f3a354.png)

![изображение](https://user-images.githubusercontent.com/28905300/177497932-3870185e-ff54-4107-bb5a-d5f29276e8e6.png)

![изображение](https://user-images.githubusercontent.com/28905300/177498576-70a9b2db-a63d-4d08-a9a0-9c05f8934e97.png)

![изображение](https://user-images.githubusercontent.com/28905300/177498661-e1d3a358-d6b5-417b-90f9-d16178fb1473.png)

![изображение](https://user-images.githubusercontent.com/28905300/177498750-34c25ebe-e1cd-4e34-8ab6-6c3247f8d1c7.png)

![изображение](https://user-images.githubusercontent.com/28905300/177498902-8af17bf4-679a-41e9-b50c-d1b9adfffb7c.png)

![изображение](https://user-images.githubusercontent.com/28905300/177498993-bce3ef34-10de-4d50-b34d-e3c3b44ee833.png)

### *Все последующие операции выполняются одинаково на WEB-L и WEB-R!*

![изображение](https://user-images.githubusercontent.com/28905300/177500887-ffef8685-b9a3-46f3-9f80-185c4744df12.png)

![изображение](https://user-images.githubusercontent.com/28905300/177500960-0b191ee1-2600-4268-b498-89fdeffaae3b.png)

![изображение](https://user-images.githubusercontent.com/28905300/177501072-6963eb89-b516-4452-935a-e311a26c2518.png)

![изображение](https://user-images.githubusercontent.com/28905300/177501158-a19b6f0d-a45c-4538-a84e-1ec60c3cc48e.png)

###### #После выполнения тех же действий на WEB-L, в качестве итоговой проверки следует создать нового пользователя (желательно на WEB-L и WEB-R), зайти из под него и попробовать создать, отредактировать и удалить файлы по пути */opt/share*. Ограничений в действиях быть не должно.

![изображение](https://user-images.githubusercontent.com/28905300/177501362-26afca70-2ce4-4598-97aa-c7a8f39462b8.png)

![изображение](https://user-images.githubusercontent.com/28905300/177501424-0e4d436d-ba2c-4012-8709-0033378f54b5.png)
##
5. (Один из возможных вариантов) Реализуйте файловый сервер на базе SRV
   - Сервер должен предоставлять доступ для обмена файлами серверам WEB-L и WEB-R; 
   - Сервер, в зависимости от ОС, использует следующие каталоги для хранения файлов:
     - /mnt/storage для система на базе Linux; 
     - Диск R:\ для систем на базе Windows; 
   - Все созданные файлы в рамках обмена должны принадлежать одному специальному пользователю;
6. Сервера WEB-L и WEB-R должны использовать службу, настроенную на SRV, для обмена файлами между собой:
   - Служба файлового обмена должна позволять монтирование в виде стандартного каталога Linux;
     - Разделяемый каталог должен быть смонтирован по адресу /opt/share;
   - Каталог должен позволять удалять и создавать файлы в нем для всех пользователей;

###### #Именно в этом варианте условия задания кардинально отличаются от тех, что вариантом выше:
###### #1.	Нет необходимости создавать RAID 1.
###### #2.	Не указано, что необходимо реализовывать именно файловый *SMB*-сервер, то есть, можно любой другой.
###### #3.	Условие «Все созданные файлы в рамках обмена должны принадлежать одному специальному пользователю» следует понимать так: создаваемые файлы в */mnt/storage* (SRV) и */opt/share* (WEB-L и WEB-R), при проверке через *ls -l*, должны показывать свою принадлежность конкретному пользователю, допустим, *tester*, а не *root* и *nobody*.
###### #4.	Условие с принадлежностью файлов конкретному пользователю ставит под сомнение возможность использования Samba, так как там это крайне трудно реализовать.
###### #Поэтому в этом примере файловый сервер будет реализовываться помощью *NFS*.

![изображение](https://user-images.githubusercontent.com/28905300/177512226-bb858994-e3b7-4c9c-9c0e-c07104abd3eb.png)

![изображение](https://user-images.githubusercontent.com/28905300/177512322-e37a8a51-3863-42c4-833a-05aeee0c5b5f.png)

![изображение](https://user-images.githubusercontent.com/28905300/177512438-7a9d6e13-663b-482f-872a-df34d763faab.png)

![изображение](https://user-images.githubusercontent.com/28905300/177512593-7af02043-094b-40c9-8c57-30d883a342a9.png)

![изображение](https://user-images.githubusercontent.com/28905300/177512680-49b79e84-16b3-41a3-b83e-cf8f7270b206.png)

![изображение](https://user-images.githubusercontent.com/28905300/177512781-b1065310-7122-4969-b165-9428eadfdeb3.png)

###### #Теперь необходимо внести изменения в конфигурационный файл */etc/exports*, позволяющие осуществить монтирование каталогов с помощью NFS. Параметры первой добавленной строки позволят создавать файлы на SRV из под пользователя *tester*. Следующие четыре строки дают доступ хостам к каталогу */mnt/storage* и также выполняют функции первой строки.

![изображение](https://user-images.githubusercontent.com/28905300/177513027-cc99cfed-9596-4d38-a9cf-5a30b1ab5194.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513118-924eab2d-77dd-4ba7-b00b-23971dff1a25.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513208-b2552e79-6093-4b5a-97b5-87558a028273.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513349-30aaa8c5-addf-4f51-a85d-2dd532bc63dc.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513419-3dbc8188-44bc-4db3-9178-cf068d47f5b2.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513517-031f322a-573a-46e0-a45c-fde127487112.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513634-deb40883-aa95-4917-8a36-7014764dfcd9.png)

![изображение](https://user-images.githubusercontent.com/28905300/177513708-56a9897c-34a3-45ac-aadd-1d408e981a60.png)

###### #Если ВДРУГ потребуется перезагрузить *SRV*, то скорее всего, после ввода команды *reboot*, появится такое сообщение. Ничего страшного в нём нет, потребуется только подождать 1-2 минуты до завершения перезагрузки.

![изображение](https://user-images.githubusercontent.com/28905300/177513927-31cef7de-8808-49e9-9c10-0e8fae7f9323.png)

###### #Проверка создания и доступа к файлам, из под других пользователей, аналогична первому варианту.
##
5. (Одна из возможных полных альтернатив настройке файлового сервера) Выполните конфигурацию служб SSH на WEB-L и WEB-R:
   - SSH-сервер должен использовать порт 1022;
   - Подключение с аккаунтом root разрешено только в связках WEB-L  WEB-R и WEB-R  WEB-L;
   - Внешние подключения к WEB-L возможны только для специально созданного аккаунта sshuser;
   - Подключения из внутренних сетей к WEB-L и WEB-R возможны для любых аккаунтов, кроме root;

###### #Все необходимые настройки вносятся в конфигурационный файл */etc/ssh/sshd_config*, на WEB-L и WEB-R. И так как в этом задании изменён порт ssh, то позже нужно будет изменить правила в файрволлах на RTR-L и RTR-R, для обеспечения корректного доступа с внешних сетей.

###### #В конфигурационных файлах ниже используются специальные символы для сокращения количества записей:
###### ? (вопрос) - означает абсолютно любой *один* символ, *один* знак или *одну* цифру.
###### * (звезда) - означает абсолютно *любое количество* символов, знаков или цифр.
###### #То есть, запись *root@192.168.100.* * включает в себя связку из аккаунта *root* и диапазона адресов внутренней сети *192.168.100.0 - 192.168.100.255*.
###### #Запись *sshuser@?.?.?.* * включает в себя связку из аккаунта *sshuser* и диапазонов адресов, которым соответствуют внешние сети в задании: *3.3.3.0 - 3.3.3.255, 4.4.4.0 - 4.4.4.255, 5.5.5.0 - 5.5.5.255*.
###### #Запись * *@192.168.100.* * включает в себя связку из любых аккаунтов и диапазона адресов внутренней сети *192.168.100.0 - 192.168.100.255*.

###### #Две части конфигурационного файла на WEB-L:

![изображение](https://user-images.githubusercontent.com/28905300/177518828-989c5479-15a5-48fe-b4bb-7e9004410907.png)

![изображение](https://user-images.githubusercontent.com/28905300/177518952-8c138043-8183-437e-8bd9-f38b778dbd84.png)

###### #Две части конфигурационного файла на WEB-R:

![изображение](https://user-images.githubusercontent.com/28905300/177519195-2d94e644-0ed6-4f46-aa88-39766c90a09b.png)

![изображение](https://user-images.githubusercontent.com/28905300/177519293-13469583-3942-4a2d-aed0-f85081550c92.png)

###### #Далее необходимо сгенерировать приватные и публичные ключи на WEB-L и WEB-R, а после — отправить друг другу только публичные ключи. Предполагается, что по беспарольной аутентификации, с использованием ключей, WEB-L и WEB-R будут взаимодействовать только между собой. А с остальными ПК и не-root аккаунтами — по паролям.
###### #Такие действия необходимы для соблюдения условий задания о запрете на вход из под root со стороны внутренних сетей, а конкретнее, с адресов GRE-туннеля. Через *DenyUsers* в */etc/ssh/sshd_config* не получится просто запретить связку *root@10.5.5.* *, в противном случае соединение по ssh между WEB-L и WEB-R не будет устанавливаться.

![изображение](https://user-images.githubusercontent.com/28905300/177520469-9b3aad82-791f-4d9e-a19f-995ac15fa229.png)

![изображение](https://user-images.githubusercontent.com/28905300/177520598-0acca467-e630-46f2-bd43-df45fd410eb9.png)

###### #Редактирование правил на файрволлах RTR-L и RTR-R, которые касаются именно перенаправления подключений по ssh. 

![изображение](https://user-images.githubusercontent.com/28905300/177520756-f0b5e284-61a0-4443-b9bd-497f666efa30.png)

![изображение](https://user-images.githubusercontent.com/28905300/177520866-7015f501-4dbf-4922-bf72-ed91e8796cbc.png)

###### #Теперь, для проверки соблюдения всех заданных условий, необходимо создать какого-нибудь пользователя *и* пользователя *sshuser* на WEB-L и WEB-R. Затем, в различных вариациях пробовать подключаться по ssh к WEB-L и WEB-R.

![изображение](https://user-images.githubusercontent.com/28905300/177521127-fd9598e1-293a-4cca-aa8b-2c54c6d61fbc.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521241-9cc1018f-eaa0-4368-8503-1fa081762cbb.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521363-c6ea9c7b-7024-48f7-b4d3-1e7290b887c9.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521476-15b356bc-6f20-4f92-bdc1-f8d9ed0a51fd.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521549-3f2d549b-508c-4d23-938e-6f3378fbd110.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521657-d025fa83-47f1-4b3c-abdc-c93ab3b84cc2.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521744-b8fb2a07-3aa9-4692-8fa1-e5e8201fb636.png)

![изображение](https://user-images.githubusercontent.com/28905300/177521863-ec107ad5-8eda-4ebe-952a-25a2eed31cb6.png)
##
7. Выполните настройку центра сертификации на базе SRV:
   - В случае применения решения на базе Linux используется центр сертификации типа OpenSSL и располагается по адресу /var/ca
   - Выдаваемые сертификаты должны иметь срок жизни не менее 500 дней;
   - Параметры выдаваемых сертификатов:
     - Страна RU;
     - Организация DEMO.WSR;
     - Прочие поля (за исключением CN) должны быть пусты;

![изображение](https://user-images.githubusercontent.com/28905300/177522878-431a4f97-8a0a-4cca-a27d-5fa047d27878.png)

![изображение](https://user-images.githubusercontent.com/28905300/177523038-d00a22d8-6281-4b37-98e5-be13d9fe77d2.png)

![изображение](https://user-images.githubusercontent.com/28905300/177523811-10f68f3f-9f78-4091-b45a-7f734538548a.png)

![изображение](https://user-images.githubusercontent.com/28905300/177526642-1ef34435-f9c1-4ac7-a44c-b40ef44dc331.png)

![изображение](https://user-images.githubusercontent.com/28905300/177526743-bd28a1e2-49e9-457c-9de9-cc42adfcd2c0.png)

![изображение](https://user-images.githubusercontent.com/28905300/177526926-c79f3746-42ea-494c-aa2c-e9806ab360f2.png)

![изображение](https://user-images.githubusercontent.com/28905300/177527036-9c3356bb-b87d-472c-b4cc-156eca1dfee1.png)

![изображение](https://user-images.githubusercontent.com/28905300/177527217-75f46218-4e1f-47bc-8339-dab47d87e18c.png)

###### #По пути */var/ca/* теперь расположен наш локальный корневой центр сертификации, со всеми необходимыми для него файлами.
##
## Инфраструктура веб-приложения.
Данный блок подразумевает установку и настройку доступа к веб-приложению, выполненному в формате контейнера Docker
1. Образ Docker (содержащий веб-приложение) расположен на ISO-образе дополнительных материалов;
   - Выполните установку приложения AppDocker0;
2. Пакеты для установки Docker расположены на дополнительном ISO-образе;
3. Инструкция по работе с приложением расположена на дополнительном ISO-образе;

![изображение](https://user-images.githubusercontent.com/28905300/177527698-d6a28335-ce5c-40a5-9d35-3bfb20ac53a3.png)

![изображение](https://user-images.githubusercontent.com/28905300/177531497-5ecd22c0-0f1e-4ddc-b6bf-1f0361ab0491.png)

![изображение](https://user-images.githubusercontent.com/28905300/177531589-66a41f74-c307-472a-9b17-6364bba5913c.png)

###### #*Если файл имеет расширение просто tar, то распаковывать его не нужно! Добавляем образ с расширением tar так же, в локальный docker-репозиторий по инструкции ниже.*

![изображение](https://user-images.githubusercontent.com/28905300/177531728-3e92741f-1ab3-48f8-bdc7-849b29b11824.png)

###### #*Порт сервера может быть другим, 80 например. На этом моменте нужно заострить внимание, иначе веб-страница на CLI не откроется!*

![изображение](https://user-images.githubusercontent.com/28905300/177531935-e9f43bb9-0797-439a-914c-b0b0ab80565d.png)
##
4. Необходимо реализовать следующую инфраструктуру приложения.
   - Клиентом приложения является CLI (браузер Edge);
   - Хостинг приложения осуществляется на ВМ WEB-L и WEB-R;
   - Доступ к приложению осуществляется по DNS-имени www.demo.wsr;
     - Имя должно разрешаться во “внешние” адреса ВМ управления трафиком в обоих регионах;
     - При необходимости, для доступа к к приложению допускается реализовать реверс-прокси или трансляцию портов;

###### #*Инструкция* (Readme.txt) по работе с приложением в docker-контейнере написана на русском языке. Имеющееся ПО в Debian для просмотра и редактирования текстовых файлов не распознаёт кириллицу, поэтому целесообразнее перенести или отобразить этот файл в CLI, на Windows 10. Один из способов — отобразить содержимое инструкции через веб-страницу, при доступе к WEB-L с CLI.

![изображение](https://user-images.githubusercontent.com/28905300/177532367-0704a4d4-83dc-464f-96c2-7a6939626126.png)

###### #По указанному пути должна быть доступна инструкция. Особое внимание на используемый порт приложением.

![изображение](https://user-images.githubusercontent.com/28905300/177533093-7607ed14-ff59-45e4-8d50-fb06dacc9b31.png)

###### #Второй способ — скопировать инструкцию Readme.txt с WEB-L на CLI, через scp с использованием настроенного ранее порта 2222.

![изображение](https://user-images.githubusercontent.com/28905300/177533315-a38d56ba-94e3-45d1-bbc2-038215d47065.png)

![изображение](https://user-images.githubusercontent.com/28905300/177533634-71e97be4-e76b-4076-b850-472cf65eb969.png)
##
   - Доступ к приложению должен быть защищен с применением технологии TLS;
     - Необходимо обеспечить корректное доверие сертификату сайта, без применения “исключений” и подобных механизмов;
   - Незащищенное соединение должно переводится на защищенный канал автоматически;
5. Необходимо обеспечить отказоустойчивость приложения;
   - Сайт должен продолжать обслуживание (с задержкой не более 25 секунд) в следующих сценариях:
     - Отказ одной из ВМ Web
     - Отказ одной из ВМ управления трафиком. 

###### #Ситуация с обеспечением «доверия» к сертификату сайта здесь особая. Можно применить минимум усилий по настройке сертификации (*облегчённый вариант*), но тогда этот единственный подпункт задания не будет выполнен и по нему не засчитают 0,5 баллов (лол). Или же, при проведении более сложной настройки сертификации (*усложнённый вариант, нужно зубрить*), задание будет выполнено в полном объёме.

### Облегчённый вариант.

![изображение](https://user-images.githubusercontent.com/28905300/177535243-59543107-82a5-4ccc-83ad-ce4285cf6be5.png)

![изображение](https://user-images.githubusercontent.com/28905300/177535326-03fad6e1-7250-45ae-badf-493f6cd142e5.png)

![изображение](https://user-images.githubusercontent.com/28905300/177535393-a839eba4-572b-484f-9f53-8332873cdebb.png)

![изображение](https://user-images.githubusercontent.com/28905300/177535475-02aaa338-09a2-4636-8a90-2f81eebf6946.png)

![изображение](https://user-images.githubusercontent.com/28905300/177535548-6f7b5d02-8d57-44c7-a862-dc2b30155c63.png)

![изображение](https://user-images.githubusercontent.com/28905300/177535597-57f1890e-fb27-4ca1-a3a1-166b1d566ee0.png)

![изображение](https://user-images.githubusercontent.com/28905300/177535744-639f22d4-c412-43ee-8898-cf204921215a.png)

### Усложнённый вариант.

![изображение](https://user-images.githubusercontent.com/28905300/177536075-e240529e-2284-4004-9cb2-047c8da16254.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536142-b098dfa4-c6e7-4bf5-8eac-790c82c8c5c0.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536276-b06a753f-195a-47e8-a2e2-c08d335afdb6.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536340-c77e750a-3670-4a07-9af5-25c6e64a0efd.png)

###### #Копируем файлы в общедоступное хранилище на SRV, куда также имеют доступ WEB-L и WEB-R.
##### #*Не перепутайте!*
###### #crt - расширения сертификатов. csr - расширение запросов на подпись сертификатов. 

![изображение](https://user-images.githubusercontent.com/28905300/177536522-b4c55f99-aa2d-4913-9cbd-952ad26c676d.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536597-d1f8e5cc-fb29-419a-a022-a308e2196f54.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536666-5e073465-6c70-4c04-97e0-e3ac546f26db.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536728-5d996c23-e60f-4e53-aa63-98e660b1ba4f.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536783-b4a6324f-e5a6-4b3d-b1c1-1115b65d6c17.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536873-1f9e19c9-4e63-4438-b01d-3e35b455c810.png)

![изображение](https://user-images.githubusercontent.com/28905300/177536997-5eebadb9-926a-48d5-a737-b47fbba780c5.png)

![изображение](https://user-images.githubusercontent.com/28905300/177537215-3b08c08a-6e2a-4243-84e0-2315f8de9646.png)

![изображение](https://user-images.githubusercontent.com/28905300/177537610-a0d435db-5d3f-4765-ab79-53c91bfc1403.png)

![изображение](https://user-images.githubusercontent.com/28905300/177537702-bee8be2a-0f87-4ecd-bfa1-070a12d22720.png)

![изображение](https://user-images.githubusercontent.com/28905300/177537792-cf618724-8fb0-4f21-be20-45678dd04255.png)

###### #Теперь в браузере при вводе адреса https://www.demo.wsr должно осуществляться корректное отображение содержимого веб-страницы, без внесения сайта в исключения и т.п.
###### #При желании, можно поэкспериментировать с вызовом функций из файла Readme.txt или попробовать отключать по очереди веб-сервера (WEB-L и WEB-R) и/или маршрутизаторы (RTR-L и RTR-R). Вызовы функций должны без проблем работать, как и балансировка трафика (включается в работу другой веб-сервер взамен выключенного).

![изображение](https://user-images.githubusercontent.com/28905300/177538009-663979d3-06fd-4fc7-9c77-7f24d9268d04.png)

P.S. По факту, пункты задания с «обеспечением отказоустойчивости приложения» не являются выполненными. Вместо *отказоустойчивости*, была реализована *балансировка* (в файле конфигурации default, в nginx). Разница в том, что реализованный функционал балансировки предназначен для равномерного распределения клиентских подключений между WEB-L и WEB-R и *не способен* обеспечить стабильный доступ к веб-сайту, если отключается один из маршрутизаторов (RTR-L или RTR-R).

Время простоя, в случае отключения одного из маршрутизаторов — 35-60 секунд (больше лимита в 25 секунд по заданию).

Время простоя, в случае отключения WEB-L или WEB-R — 15-20 секунд (меньше лимита; именно так и нужно).

Реализованную балансировку на демо-экзамене вполне могут засчитать как отказоустойчивость, если квалификация проверяющих не очень высокая или если они готовы пойти на уступки. В остальном, имеется риск потерять 1,2 балла.

P.P.S. К сожалению, пока отсутствуют варианты с реализацией именно *отказоустойчивости* и именно в рамках задания.
